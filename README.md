# optpod: 最適化テスト実行ツール

`optpod` は、最適化コンテストのテストケースを並列実行し、結果を収集・分析するためのコマンドラインツールです。

## インストール

```bash
cargo install --git https://github.com/qropa/optpod
```

## 初期化

`optpod` を使用する前に、設定ファイルを初期化する必要があります。

```bash
optpod init
# または
optpod i
```

このコマンドを実行すると、カレントディレクトリに `optpod_config.toml` ファイルが生成されます。このファイルには、以下の設定項目が含まれています。

*   **`input`**: テストケースの入力として使用するファイル名のテンプレートです。
*   **`result_dir`**: テスト結果を保存するディレクトリです。
*   **`default_id`**: デフォルトの実行 ID です。
*   **`output`**: テストケースの標準出力として使用するファイル名のテンプレートです。
*   **`error`**: テストケースの標準エラー出力として使用するファイル名のテンプレートです。 
*   **`cmd_tester`**: 実行するコマンドです。
*   **`extraction_regex`**: 標準エラー出力からデータを抽出するための正規表現です。`(?P<VARIABLE>\w+)=(?P<VALUE>[\w.]+)` のように名前付きキャプチャグループを使用してください。`VARIABLE` は抽出する変数名、`VALUE` はその値を表します。
*   **`scoring`**: スコアリングの方法です。`"max"` の場合は最大のスコア、`"min"` の場合は最小のスコアがベストとされます。
*   **`threads_no`**: 並列実行するスレッド数です。`0` を指定すると、システムが使用可能な最大スレッド数が使用されます。

## テストケース実行

テストケースを実行するには、`run` コマンドまたは `r` コマンドを使用します。

```bash
optpod run [テストケース範囲] [実行ID (オプション)]
# または
optpod r [テストケース範囲] [実行ID (オプション)]
```

### テストケース範囲の指定

テストケース範囲は、次の形式で指定します。

*   `n-m`: n から m までのテストケースを実行します (n と m を含む)。例: `1-100`
*   `n`: 0 から n までのテストケースを実行します (n を含む)。例: `100`

### 実行IDの指定 (オプション)

実行IDを指定しない場合は、`optpod_config.toml` の `default_id` が使用されます。実行IDを指定する場合は、テストケース範囲の後に指定します。

### 例

*   テストケース 1 から 100 をデフォルトの実行IDで実行する場合:
    ```bash
    optpod r 1-100
    ```
*   テストケース 1 から 100 を `beam` という実行IDで実行する場合:
    ```bash
    optpod r 1-100 beam
    ```
*   テストケース 0 から 100 をデフォルトの実行IDで実行する場合:
    ```bash
     optpod r 100
    ```

## ベスト結果の更新

現在のベスト結果を更新するには、`best` コマンドまたは `b` コマンドを使用します。

```bash
optpod best [実行ID (オプション)]
# または
optpod b [実行ID (オプション)]
```

実行IDを指定しない場合は、`optpod_config.toml` の `default_id` が使用されます。

### 例

*   デフォルトの実行IDの結果をベストに反映する場合:
    ```bash
    optpod b
    ```
*   `beam` という実行IDの結果をベストに反映する場合:
    ```bash
    optpod b beam
    ```

## 統計情報の表示

テスト結果の統計情報を表示するには、`show` コマンドまたは `s` コマンドを使用します。

```bash
optpod show [変数名] [開始値] [終了値] [刻み幅] [実行ID (オプション)]
# または
optpod s [変数名] [開始値] [終了値] [刻み幅] [実行ID (オプション)]
```

### 変数名

`optpod_config.toml` の `extraction_regex` で指定した名前付きキャプチャグループの `VARIABLE` に対応する変数名を指定します。

### 開始値、終了値、刻み幅

変数の範囲と、平均を計算する際の刻み幅を指定します。

### 実行IDの指定 (オプション)

実行IDを指定しない場合は、`optpod_config.toml` の `default_id` が使用されます。

### 例

*   `default_id` の結果の `N` という変数を 1 以上 10 以下で 1 刻みで平均を計算し、スコアを表示する場合:
    ```bash
    optpod s N 1 10 1
    ```
*   `beam` という実行IDの結果の `M` という変数を 1 以上 22.5 以下で 0.1 刻みで平均を計算し、スコアを表示する場合:
    ```bash
    optpod s M 1 22.5 0.1 beam
    ```

## 補足

*   各テストケースのスコアを`score`という名前の変数として抽出することを前提としています。
特に、AtCoder ヒューリスティックコンテストのツールなどでは、スコアが`Score`となっている場合があります。その場合、適切にツールを書き換えてください。